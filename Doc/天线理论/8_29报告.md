# 基于AEP的阵列方向图快速算法（理论部分，gyc博士论文）
为了获得更好的辐射性能，阵列天线的规模需求日益庞大，阵元数目数以千计，这对大规模阵列天线设计的计算能力提出了很高的要求。采用传统的数值方法对大规模阵列进行仿真计算，其硬件成本和时间成本均难以估量。然而在设计大规模阵列之初，研究人员一般需要对阵列性能进行快速的评估，因而提出一种针对计算大规模阵列方向图的快速算法。

影响单元辐射性能的因素主要有其自身的结构以及周围的环境，若两个相同结构的单元周围的环境也类似，则可认为这两个单元的性能也基本类似，此时可以用一个单元的电磁特性来代替另一个单元，此法可避免对相似单元进行不必要的重复计算，进而减少计算时间，提高计算效率。基于上述等效计算的思想，利用有源单元方向图（Active Element Pattern，AEP）来等效大规模阵列中的类似单元的方向图，并结合方向图叠加原理，实现对大规模阵列整体方向图的快速计算。

柱面共形阵列天线与平面阵列不同，在其上排布的共形单元因几何结构的影响，单元的最大辐射方向在整体的坐标系中不尽相同，可能存在部分单元在期望方向上贡献能量较少，甚至没有贡献。为了提高阵列天线效率，避免产生额外的副瓣和栅瓣，需要进行有缘区域的选择；其次，在共形阵列天线中，单元与单元之间会存在空间位置差，一方面会导致各单元的极化方向不一致，引起总辐射场交叉极化过大的问题。另一方面会产生空间相位差，因此需要对共性单元进行极化补偿和相位补偿。综上所述，计算共性阵列方向图的基本流程如图3.1所示

本节针对基于AEP的大规模阵列方向图快速算法展开研究，重点对算法中的有源区域选择、有源单元极化补偿、单元方向图外推和阵列总场计算这四个关键步骤进行理论分析。
## 有源区域的选择
有天线原理可知，阵列的辐射增益与其有效孔径面积有关。对于平面阵列，当阵列方向图扫描到某一角度时，其有效孔径相当于实际孔径在该扫描方向上的投影。随着扫描角的增加，其有效孔径面积逐渐减小，因而辐射增益也对应减小。所以平面扫描阵列在实际应用中收到扫描角的限制难以实现广角域的波束覆盖。对于均匀的柱面共形阵列而言，阵列在XOY面的不同方向上投影相同，这使得柱面共形阵列在该平面的任意方向上具有相同的有效孔径面积，从而摆脱了阵列扫描范围的限制。

然而，对于柱面共形阵列，由于其结构不能保证所有阵列单元均处于有效孔径的范围内，当阵元的主辐射能量严重偏离阵列期望的辐射方向时，该阵元对辐射能量的贡献度将大打折扣，不仅能分散阵列能量的集束程度，降低阵列增益，还会引入不必要的副瓣和交叉极化分量。因此需要有选择性的激励有效孔径内的单元，从而使共性阵列获得最佳的辐射特性。

设阵元的最大有效辐射角为$\theta_{max}$，当阵列的主辐射方向偏离阵元辐射方向 $\theta_{max}$以上时，可以认为该阵元对阵列主辐射能量的贡献度很低，因而不激励该单元；当阵列的主辐射方向与阵列单元的最大有效辐射角之间夹角小于$\theta_{max}$时，可将该阵元视为有效阵元。所有的有效阵元构成的区域被称为有源区域，该区域的单元被称为有源单元。由于该阵列有纵向80个阵元，轴向240个阵元共19200个阵元，规定有源区域大小为80*40，因而$\theta_{max}=60^o$。

判断一个阵元是否在有源区域内，仅需判断该单元的最大辐射方向与阵列的主辐射方向的夹角是否小于$\theta_{max}$。假设阵列天线的主辐射方向$(\theta_0,z_0)$处的法线方向为$\vec{r_0}$，在空间另一点$(\theta_{mn},z_{mn})$处有一单元，其最大辐射方向为$\vec r_{mn}$，该单元的最大有效辐射角为$\theta_{max}$。当单元满足下式条件时，即可认为该单元为有源单元。
$$\vec r_0\cdot\vec r_{mn}=cos\beta_{mn}=
\begin{bmatrix}
cos\theta_0&sin\theta_0&z_0
\end{bmatrix}
\begin{bmatrix}
cos\theta_{mn}\\
sin\theta_{mn}\\
z_{mn}
\end{bmatrix}
\geq\theta_{max}
\tag{1}$$
## 有源单元的极化补偿
共形阵中的极化问题可通过单极化阵元旋转法和双极化幅度加权法来解决。
其中，单极化阵元旋转法对阵元的结构要求简单，但是适用于有源区域覆盖范围较小的情形，越靠近主辐射方向上的阵元，旋转对极化的控制效果越明显；而双极化幅度加权法是通过对单元两个正交极化的激励幅度进行合理配比来 合成新的极化，这种方式更加灵活，但要求每个单元必须有两个正交极化激励端口，这无疑加大了单元的设计难度和阵列的复杂度。本节采用单极化阵元旋转法对有源单元的极化进行补偿。

为实现有源单元的极化旋转，可通过直角坐标系的欧拉旋转变换来间接完成。将一个坐标系分别绕三个轴旋转一定的角度，即可得到另一个坐标系。根据欧拉旋转矩阵，沿x,y,z三个轴的旋转矩阵可表示：
$$R_x(\theta_1)=
\begin{bmatrix}
1&0&0\\
0&cos\theta_1&sin\theta_1\\
0&-sin\theta_1&cos\theta_1
\end{bmatrix}
\tag{2}$$
$$R_y(\theta_2)=
\begin{bmatrix}
cos\theta_2&0&-sin\theta_2\\
0&1&0\\
sin\theta_2&0&cos\theta_2
\end{bmatrix}
\tag{3}$$
$$R_z(\theta_3)=
\begin{bmatrix}
cos\theta_3&sin\theta_3&0\\
-sin\theta_3&cos\theta_3&0\\
0&0&1
\end{bmatrix}
\tag{4}$$

以下采用欧拉旋转矩阵的方式对有源单元进行极化补偿。假设阵列以圆环的形式在柱面均匀环绕排布，第m行第n个阵元为$A_{mn}$，在全局坐标系中$O-xyz$中的坐标为$(\theta_{mn},z_{mn})$。以该阵元的中心为坐标原点，建立局部坐标系$O_{mn}-x_{mn}y_{mn}z_{mn}$，阵元法线方向$\vec r$为$z_{mn}$轴，$\vec\theta$方向为$x_{mn}$轴，$\vec z$方向为$y_{mn}$轴，设该阵元的主极化矢量方向为$\vec p_{mn}$。当阵列的扫描方向为$(\theta_0,z_0)$处的法线方向$\vec r$时，在该点建立局部坐标系$O_0-x_0y_0z_0$，$\vec\theta$方向为$x_{0}$轴，$\vec z$方向为$y_{0}$轴，设阵列的主极化方向沿$x_0$轴。将阵元沿$z_{mn}$轴旋转合适角度$\triangle\phi_{mn}$，使阵元的主极化矢量$\vec p_{mn}$在局部坐标系$O_0-x_0y_0z_0$中$x_0y_0$面上的投影与阵列的主极化方向夹角最小，即可使阵元的主极化分量在阵列的主极化方向上提供最大的贡献。阵元主极化矢量$\vec p_{mn}$在局部坐标系$O_{mn}-x_{mn}y_{mn}z_{mn}$中沿$z_{mn}$轴旋转$\triangle\phi_{mn}$后坐标为：
$$p_{mn}=
\begin{bmatrix}
cos\triangle\phi_{mn}&sin\triangle\phi_{mn}&0
\end{bmatrix}
\begin{bmatrix}
\vec x_{mn}\\\vec y_{mn}\\\vec z_{mn}
\end{bmatrix}
\tag{5}$$

采用的坐标旋转方式，经过旋转变换，可将阵元的局部坐标系$O_{mn}-x_{mn}y_{mn}z_{mn}$与阵列的坐标系$O_0-x_0y_0z_0$重合。由于不同区域的柱面上的阵元局部坐标$y$轴平行，因此只需要进行将$O_{mn}-x_{mn}y_{mn}z_{mn}$沿$y_{mn}$轴旋转$\theta_0-\theta_{mn}$的操作即可完成阵元局部坐标系到阵列坐标系的变换。此时，阵元主极化矢量$\vec p_{mn}$变换为坐标系$O_0-x_0y_0z_0$中的矢量$\vec p^0_{mn}$，它在$\vec x_0$、$\vec y_0$和$\vec z_0$三个方向上的分量表达式为：
$$
\begin{bmatrix}
p^0_{mnx}\\p^0_{mny}\\p^0_{mnz}
\end{bmatrix}=
\begin{bmatrix}
cos(\theta_0-\theta_{mn})&0&-sin(\theta_0-\theta_{mn})\\
0&1&0\\
sin(\theta_0-\theta_{mn})&0&cos(\theta_0-\theta_{mn})
\end{bmatrix}
\begin{bmatrix}
cos\triangle\phi_{mn}\\sin\triangle\phi_{mn}\\0
\end{bmatrix}
\tag{6}$$
因此，主极化矢量$\vec p_{mn}$在$x_0y_0$面上的投影与阵列的主极化方向夹角可以看作求得的矢量$\vec p^0_{mn}$与$\vec x_0$之间的夹角。为了使阵元$A_{mn}$对阵列的主极化产生最大的贡献，则该阵元旋转的角度应使夹角最小。
## 单元方向图外推
单元方向图外推是基于AEP方向求解共性阵列方向图的关键，其目的是利用给定的一个或多个单元方向图，通过平移旋转的变换方法，得到阵列中其他相似单元的方向图。当给定的单元方向图为无源方向图时，所求得的阵列方向图也为无源方向图，即不考虑单元间互耦情况下的阵列方向图；当给定的方向图为有源方向图时，单元间的互耦将被纳入计算过程中，所求得的即是考虑单元间互耦情况的阵列方向图。本届采用考虑互耦情况的有源方向图，此法可提高结果的准确性和可靠性。

在全局坐标系$O-xyz$中有一共形单元位于($x_n,y_n,z_n$)处，该单元的相位中心为$O_n$。以$O_n$为坐标原点，建立局部坐标系$O_n-x^{nl}_ny^{nl}_nz^{nl}_n$，其中$z^{nl}_n$沿单元的法线方向。在获得该单元的方向图后，需要将其辐射场外推至空间全局坐标系中，从而获得共性阵列中该单元的辐射场。由于全局坐标系$O-xyz$与单元法相局部坐标系$O_n-x^{nl}_ny^{nl}_nz^{nl}_n$的单位矢量方向不一致，难以建立联系，因而先将单元法向局部坐标系$O_n-x^{nl}_ny^{nl}_nz^{nl}_n$通过旋转变换成与全局坐标系平行的空间局部坐标系$O_n-x^{l}_ny^{l}_nz^{l}_n$，该局部坐标系的原点坐标仍在单元的相位中心$O_n$处。然后，通过坐标系的平移，实现空间局部坐标系$O_n-x^{l}_ny^{l}_nz^{l}_n$到全局坐标系$O-xyz$的转换。
### 坐标系$O_n-x^{nl}_ny^{nl}_nz^{nl}_n$到$O_n-x^{l}_ny^{l}_nz^{l}_n$的转换
已知共形阵列中第n个单元的辐射场为$\vec E(\theta,z)$，它在全局坐标系中可由三个直角坐标分量表示：
$$\vec E_n(\theta,z)=E^x_n(\theta,z)\vec x+E^y_n(\theta,z)\vec y+E^z_n(\theta,z)\vec z\tag{7}$$
同理，该单元的空间局部坐标系$O_n-x^l_ny^l_nz^l_n$和法向局部坐标系$O_n-x^{nl}_ny^{nl}_nz^{nl}_n$中的分量表达式分别为
$$\vec E_n^l(\theta^l,z^l)=E^{xl}_n(\theta^l,z^l)\vec x^l+E^{yl}_n(\theta^l,z^l)\vec y^l+E^{zl}_n(\theta^l,z^l)\vec z^l\tag{8}$$
$$\vec E^{nl}_n(\theta^{nl},z^{nl})=E^{xnl}_n(\theta^{nl},z^{nl})\vec x^{nl}+E^{ynl}_n(\theta^{nl},z^{nl})\vec y^{nl}+E^{znl}_n(\theta^{nl},z^{nl})\vec z^{nl}\tag{9}$$
由于式（7）到式（9）为同一辐射场在三种坐标系下的表示，因此
$$\vec E_n(\theta,z)=\vec E_n^l(\theta^l,z^l)=\vec E^{nl}_n(\theta^{nl},z^{nl})\tag{10}$$
将式（8）和式（9）代入到式（10）中，可得
$$
\begin{bmatrix}
E^{xnl}_n(\theta^{nl}_n,z_n^{nl})&E^{ynl}_n(\theta_n^{nl},z_n^{nl})&E^{znl}_n(\theta_n^{nl},z_n^{nl})
\end{bmatrix}
\begin{bmatrix}
\vec x^{nl}_n\\\vec y_n^{nl}\\\vec z_n^{nl}
\end{bmatrix}\\=
\begin{bmatrix}
E^{xl}_n(\theta_n^l,z_n^l)&E^{yl}_n(\theta_n^l,z_n^l)&E^{zl}_n(\theta_n^l,z_n^l)
\end{bmatrix}
\begin{bmatrix}
\vec x^l_n\\\vec y^l_n\\\vec z^l_n
\end{bmatrix}
\tag{11}$$
因此，将$\vec E^{nl}_n(\theta^{nl},z^{nl})$转变为$\vec E_n^l(\theta^l,z^l)$需要构建两组对应关系：首先是两个坐标系中方向单位矢量$(\vec x^{nl},\vec y^{nl},\vec z^{nl})$和$(\vec x^{l},\vec y^{l},\vec z^{l})$之间的关系，其次是两个柱面坐标$(\theta^{nl}_n,z^{nl}_n)$与$(\theta^{nl}_n,z^{nl}_n)$之间的关系。

对于方向单位矢量$(\vec x^{nl},\vec y^{nl},\vec z^{nl})$和$(\vec x^{l},\vec y^{l},\vec z^{l})$的变换，可通过三次旋转矩阵相乘来完成，采用“y-z-y”的旋转顺序，设三次旋转的角度为$\alpha$、$\beta$和$\gamma$，其中$\alpha$是以$y^{nl}$轴为旋转轴，$\beta$是以第一次旋转后的新的$z^{nl}$轴为旋转轴，$\gamma$是以第二次旋转后的新的$y_{nl}$轴为旋转轴。相应的欧拉旋转矩阵为：
$$I=I_3I_2I_1\tag{12}$$
其中
$$
I_1=
\begin{bmatrix}
cos\alpha&0&-sin\alpha\\
0&1&0\\
sin\alpha&0&cos\alpha
\end{bmatrix}
\tag{13}$$
$$
I_2=
\begin{bmatrix}
cos\beta&sin\beta&0\\
-sin\beta&cos\beta&0\\
0&0&1
\end{bmatrix}
\tag{14}$$
$$
I_3=
\begin{bmatrix}
cos\gamma&0&-sin\gamma\\
0&1&0\\
sin\gamma&0&cos\gamma
\end{bmatrix}
\tag{15}$$

则两个方向单位矢量之间的关系为：
$$
\begin{bmatrix}
\vec x^{l}_n\\\vec y^{l}_n\\\vec z^{l}_n
\end{bmatrix}=I
\begin{bmatrix}
\vec x^{nl}_n\\\vec y^{nl}_n\\\vec z_n^{nl}
\end{bmatrix}=I_3I_2I_1
\begin{bmatrix}
\vec x^{nl}_n\\\vec y^{nl}_n\\\vec z_n^{nl}
\end{bmatrix}
\tag{16}$$

对于法向局部坐标$(\theta_n^{nl},z_n^{nl})$到空间局部坐标$(\theta_n^{l},z_n^{l})$的转换，将式（16）代入到式（11）中得：
$$
\begin{bmatrix}
E^{xnl}_n(\theta^{nl}_n,z_n^{nl})&E^{ynl}_n(\theta_n^{nl},z_n^{nl})&E^{znl}_n(\theta_n^{nl},z_n^{nl})
\end{bmatrix}
\begin{bmatrix}
\vec x^{nl}_n\\\vec y_n^{nl}\\\vec z_n^{nl}
\end{bmatrix}=\\
\begin{bmatrix}
E^{xl}_n(\theta_n^l,z_n^l)&E^{yl}_n(\theta_n^l,z_n^l)&E^{zl}_n(\theta_n^l,z_n^l)
\end{bmatrix}I_3I_2I_1
\begin{bmatrix}
\vec x^{nl}_n\\\vec y_n^{nl}\\\vec z_n^{nl}
\end{bmatrix}
\tag{17}$$
对空间中某一点P处的场，假设其在法向局部坐标系中的坐标为$(R_n^{nl},\theta_n^{nl},z_n^{nl})$，将其转换为直角坐标的形式：
$$
E_n^{nlx}(\theta_n^{nl},z_n^{nl})=R_n^{nl}cos\theta_n^{nl}\\
E_n^{nly}(\theta_n^{nl},z_n^{nl})=R_n^{nl}sin\theta_n^{nl}\\
E_n^{nlz}(\theta_n^{nl},z_n^{nl})=z_n^{nl}
\tag{18}$$
设P点在空间局部坐标系中的坐标为$(R_n^{l},\theta_n^{l},z_n^{l})$，同理，也可写出其直角坐标公式：
$$
E_n^{lx}(\theta_n^{l},z_n^{l})=R_n^{l}cos\theta_n^{l}\\
E_n^{ly}(\theta_n^{l},z_n^{l})=R_n^{l}sin\theta_n^{l}\\
E_n^{lz}(\theta_n^{l},z_n^{l})=z_n^{l}
\tag{19}$$
此时，由于法向局部坐标系$O_n-x_n^{nl}y_n^{nl}z_n^{nl}$与空间局部坐标系$O_n-x_n^{l}y_n^{l}z_n^{l}$的原点为同一点$O_n$，因此该点在这两个坐标系下到P点的距离相等，即$R^l_n=R_n^{nl}$。

联合式（17）到式（19）得：
$$
\begin{bmatrix}
cos\theta_n^{nl}&sin\theta_n^{nl}&z_n^{nl}
\end{bmatrix}
\begin{bmatrix}
\vec x^{nl}_n\\\vec y_n^{nl}\\\vec z_n^{nl}
\end{bmatrix}\\=
\begin{bmatrix}
cos\theta_n^{l}&sin\theta_n^{l}&z_n^l
\end{bmatrix}I_3I_2I_1
\begin{bmatrix}
\vec x^{nl}_n\\\vec y_n^{nl}\\\vec z_n^{nl}
\end{bmatrix}
\tag{20}$$
将旋转矩阵代入上式可得
$$
\begin{bmatrix}
cos\theta_n^{nl}&sin\theta_n^{nl}&z_n^{nl}
\end{bmatrix}=\\
\begin{bmatrix}
cos\theta_n^{l}&sin\theta_n^{l}&z_n^l
\end{bmatrix}
\begin{bmatrix}
cos\gamma&0&-sin\gamma\\
0&1&0\\
sin\gamma&0&cos\gamma
\end{bmatrix}
\begin{bmatrix}
cos\beta&sin\beta&0\\
-sin\beta&cos\beta&0\\
0&0&1
\end{bmatrix}
\begin{bmatrix}
cos\alpha&0&-sin\alpha\\
0&1&0\\
sin\alpha&0&cos\alpha
\end{bmatrix}
\tag{21}$$
由式（21）中$(\theta_n^{nl},z_n^{nl})$到$(\theta_n^{l},z_n^{l})$得变换关系，可以得到
$
\begin{bmatrix}
E_n^{nlx}(\theta_n^{nl},z_n^{nl})&E_n^{nly}(\theta_n^{nl},z_n^{nl})&E_n^{nlz}(\theta_n^{nl},z_n^{nl})
\end{bmatrix}
$
到
$
\begin{bmatrix}
E_n^{lx}(\theta_n^{l},z_n^{l})&E_n^{ly}(\theta_n^{l},z_n^{l})&E_n^{lz}(\theta_n^{l},z_n^{l})
\end{bmatrix}
$
的变换。至此，实现了单元法向局部坐标系$O_n-x_n^{nl}y_n^{nl}z_n^{nl}$与空间局部坐标系$O_n-x_n^{l}y_n^{l}z_n^{l}$的转换。
### 坐标系$O_n-x_n^{l}y_n^{l}z_n^{l}$到$O-xyz$的转换
将式（7）和式（8）代入到式（10）中可得$\vec E_n(\theta,z)$和$\vec E_n^l(\theta^l_n,z^l_n)$之间的关系：
$$
\begin{bmatrix}
E_n^x(\theta,z)&E_n^y(\theta,z)&E_n^z(\theta,z)
\end{bmatrix}
\begin{bmatrix}
\vec x\\\vec y\\\vec z
\end{bmatrix}\\=
\begin{bmatrix}
E_n^{lx}(\theta^l,z^l)&E_n^{ly}(\theta^l,z^l)&E_n^{lz}(\theta^l,z^l)
\end{bmatrix}
\begin{bmatrix}
\vec x^l_n\\\vec y^l_n\\\vec z^l_n
\end{bmatrix}
\tag{22}$$
与法向局部坐标系到空间局部坐标系类似，空间局部坐标系到全局坐标系的变换同样可分为两个对应关系，即方向单位矢量$(\vec x^l_n,\vec y^l_n,\vec z^l_n)$和$(\vec x,\vec y,\vec z)$之间的关系以及两个柱面坐标$(\theta_n^l,z^l_n)$和$(\theta,z)$之间的关系。

对于远场中的某一点P，可以认为$OP$和$OP'$是平行的，由于两个坐标系的方向单位矢量式是平行的，因此有$\vec x=\vec x^l_n$，$\vec y=\vec y^l_n$，$\vec z=\vec z^l_n$，$\theta=\theta^l_n$。所以两个坐标系之间只存在一个波程差$d_n$，它可以看作是$\vec R_n$在$\vec R$方向上的投影：
$$
d_n=\hat R\cdot\vec R_n=\hat R\cdot\hat R_nR_n
\tag{23}$$
式中
$$
\hat R=\hat xcos\theta+\hat ysin\theta+\hat z
\tag{24}$$
$$
\hat R_n=\hat xcos\theta_n+\hat ysin\theta_n+\hat z
\tag{25}$$
为两条射线的单位矢量，$R_n$为$OO_n$的距离。因此可结合式（23）到式（25）得到$d_n$。由此可求得全局坐标系下的单元辐射场表达式：
$$
\vec E_n(\theta,z)=\vec E^l_n(\theta^l_n,z^l_n)exp(jkd_n)
\tag{26}$$
至此，完成了一直阵列中某个单元局部坐标系下的辐射场来求得它在阵列全局坐标系下的全过程。基于AEP的方法可将阵列中不同位置但具有相似特性的单元用同一个局部坐标系下的辐射场来表示，因此省略了对阵列中部分单元辐射场的计算，仅需要通过坐标的变换，即可获得不同单元在全局坐标系的辐射场，极大的减少了计算时间。
### 阵列总场的计算
根据上述的三个步骤：有源单元的选取、有源单元的极化补偿和单元方向图外推，可以得到阵列中全部有源单元在全局坐标系下的单元辐射场，应用方向图叠加原理，即可获得阵列的辐射总场：
$$
\vec E(\theta,z)=\sum^N_{n=1}\vec E_n(\theta,z)
\tag{27}$$
## 程序设计与演示算例
共形阵方向图快速计算程序主要包含三大功能模块：输入模块、计算模块和输出模块。

首先通过输入模块输入模型的结构参数，包括载体的尺寸和阵列的排布方式，设定单元的工作频率，读取单元的基本辐射场信息，并进行数据的预处理；给出计算所需的初始条件，包含单元最大有效辐射角
## 阵列仿真计算结果

////////////////////////////////////////////////////////

# 基于AEP的阵列方向图快速算法（理论部分，gyc博士论文）
为了获得更好的辐射性能，阵列天线的规模需求日益庞大，阵元数目数以千计，这对大规模阵列天线设计的计算能力提出了很高的要求。采用传统的数值方法对大规模阵列进行仿真计算，其硬件成本和时间成本均难以估量。然而在设计大规模阵列之初，研究人员一般需要对阵列性能进行快速的评估，因而提出一种针对计算大规模阵列方向图的快速算法。

影响单元辐射性能的因素主要有其自身的结构以及周围的环境，若两个相同结构的单元周围的环境也类似，则可认为这两个单元的性能也基本类似，此时可以用一个单元的电磁特性来代替另一个单元，此法可避免对相似单元进行不必要的重复计算，进而减少计算时间，提高计算效率。基于上述等效计算的思想，利用有源单元方向图（Active Element Pattern，AEP）来等效大规模阵列中的类似单元的方向图，并结合方向图叠加原理，实现对大规模阵列整体方向图的快速计算。

柱面共形阵列天线与平面阵列不同，在其上排布的共形单元因几何结构的影响，单元的最大辐射方向在整体的坐标系中不尽相同，可能存在部分单元在期望方向上贡献能量较少，甚至没有贡献。为了提高阵列天线效率，避免产生额外的副瓣和栅瓣，需要进行有缘区域的选择；其次，在共形阵列天线中，单元与单元之间会存在空间位置差，一方面会导致各单元的极化方向不一致，引起总辐射场交叉极化过大的问题。另一方面会产生空间相位差，因此需要对共性单元进行极化补偿和相位补偿。综上所述，计算共性阵列方向图的基本流程如图3.1所示

本节针对基于AEP的大规模阵列方向图快速算法展开研究，重点对算法中的有源区域选择、有源单元极化补偿、单元方向图外推和阵列总场计算这四个关键步骤进行理论分析。

## 有源区域的选择
有天线原理可知，阵列的辐射增益与其有效孔径面积有关。对于平面阵列，当阵列方向图扫描到某一角度时，其有效孔径相当于实际孔径在该扫描方向上的投影。随着扫描角的增加，其有效孔径面积逐渐减小，因而辐射增益也对应减小。所以平面扫描阵列在实际应用中收到扫描角的限制难以实现广角域的波束覆盖。对于均匀的柱面共形阵列而言，阵列在XOY面的不同方向上投影相同，这使得柱面共形阵列在该平面的任意方向上具有相同的有效孔径面积，从而摆脱了阵列扫描范围的限制。

然而，对于柱面共形阵列，由于其结构不能保证所有阵列单元均处于有效孔径的范围内，当阵元的主辐射能量严重偏离阵列期望的辐射方向时，该阵元对辐射能量的贡献度将大打折扣，不仅能分散阵列能量的集束程度，降低阵列增益，还会引入不必要的副瓣和交叉极化分量。因此需要有选择性的激励有效孔径内的单元，从而使共性阵列获得最佳的辐射特性。

设阵元的最大有效辐射角为$\theta_{max}$，当阵列的主辐射方向偏离阵元辐射方向 $\theta_{max}$以上时，可以认为该阵元对阵列主辐射能量的贡献度很低，因而不激励该单元；当阵列的主辐射方向与阵列单元的最大有效辐射角之间夹角小于$\theta_{max}$时，可将该阵元视为有效阵元。所有的有效阵元构成的区域被称为有源区域，该区域的单元被称为有源单元。由于该阵列有纵向80个阵元，轴向240个阵元共19200个阵元，规定有源区域大小为80*40，因而$\theta_{max}=60^o$。

判断一个阵元是否在有源区域内，仅需判断该单元的最大辐射方向与阵列的主辐射方向的夹角是否小于$\theta_{max}$。假设阵列天线的主辐射方向$(\theta_0,z_0)$处的法线方向为$\hat{r_0}$，在空间另一点$(\theta_{mn},z_{mn})$处有一单元，其最大辐射方向为$\hat r_{mn}$，该单元的最大有效辐射角为$\theta_{max}$。当单元满足下式条件时，即可认为该单元为有源单元。
$$\hat r_0\cdot\hat r_{mn}=cos\beta_{mn}=
\begin{bmatrix}
cos\theta_0&sin\theta_0
\end{bmatrix}
\begin{bmatrix}
cos\theta_{mn}\\sin\theta_{mn}
\end{bmatrix}
\geq\theta_{max}
\tag{1}$$

## 有源单元的极化补偿
共形阵中的极化问题可通过单极化阵元旋转法和双极化幅度加权法来解决。
其中，单极化阵元旋转法对阵元的结构要求简单，但是适用于有源区域覆盖范围较小的情形，越靠近主辐射方向上的阵元，旋转对极化的控制效果越明显；而双极化幅度加权法是通过对单元两个正交极化的激励幅度进行合理配比来 合成新的极化，这种方式更加灵活，但要求每个单元必须有两个正交极化激励端口，这无疑加大了单元的设计难度和阵列的复杂度。本节采用单极化阵元旋转法对有源单元的极化进行补偿。

为实现有源单元的极化旋转，可通过直角坐标系的欧拉旋转变换来间接完成。将一个坐标系分别绕三个轴旋转一定的角度，即可得到另一个坐标系。根据欧拉旋转矩阵，沿x,y,z三个轴的旋转矩阵可表示：
$$R_x(\theta_1)=
\begin{bmatrix}
1&0&0\\
0&cos\theta_1&sin\theta_1\\
0&-sin\theta_1&cos\theta_1
\end{bmatrix}
\tag{2}$$
$$R_y(\theta_2)=
\begin{bmatrix}
cos\theta_2&0&-sin\theta_2\\
0&1&0\\
sin\theta_2&0&cos\theta_2
\end{bmatrix}
\tag{3}$$
$$R_z(\theta_3)=
\begin{bmatrix}
cos\theta_3&sin\theta_3&0\\
-sin\theta_3&cos\theta_3&0\\
0&0&1
\end{bmatrix}
\tag{4}$$

以下采用欧拉旋转矩阵的方式对有源单元进行极化补偿。假设阵列以圆环的形式在柱面均匀环绕排布，第m行第n个阵元为$A_{mn}$，在全局坐标系中$O-xyz$中的坐标为$(\theta_{mn},z_{mn})$。以该阵元的中心为坐标原点，建立局部坐标系$O_{mn}-x_{mn}y_{mn}z_{mn}$，阵元法线方向$\hat r$为$z_{mn}$轴，$\hat\theta$方向为$x_{mn}$轴，$\hat z$方向为$y_{mn}$轴，设该阵元的主极化矢量方向为$\hat p_{mn}$。当阵列的扫描方向为$(\theta_0,z_0)$处的法线方向$\hat r$时，在该点建立局部坐标系$O_0-x_0y_0z_0$，$\hat\theta$方向为$x_{0}$轴，$\hat z$方向为$y_{0}$轴，设阵列的主极化方向沿$x_0$轴。将阵元沿$z_{mn}$轴旋转合适角度$\triangle\phi_{mn}$，使阵元的主极化矢量$\hat p_{mn}$在局部坐标系$O_0-x_0y_0z_0$中$x_0y_0$面上的投影与阵列的主极化方向夹角最小，即可使阵元的主极化分量在阵列的主极化方向上提供最大的贡献。阵元主极化矢量$\hat p_{mn}$在局部坐标系$O_{mn}-x_{mn}y_{mn}z_{mn}$中沿$z_{mn}$轴旋转$\triangle\phi_{mn}$后坐标为：
$$p_{mn}=
\begin{bmatrix}
cos\triangle\phi_{mn}&sin\triangle\phi_{mn}&0
\end{bmatrix}
\begin{bmatrix}
\hat x_{mn}\\\hat y_{mn}\\\hat z_{mn}
\end{bmatrix}
\tag{5}$$

采用的坐标旋转方式，经过旋转变换，可将阵元的局部坐标系$O_{mn}-x_{mn}y_{mn}z_{mn}$与阵列的坐标系$O_0-x_0y_0z_0$重合。由于不同区域的柱面上的阵元局部坐标$y$轴平行，因此只需要进行将$O_{mn}-x_{mn}y_{mn}z_{mn}$沿$y_{mn}$轴旋转$\theta_0-\theta_{mn}$的操作即可完成阵元局部坐标系到阵列坐标系的变换。此时，阵元主极化矢量$\hat p_{mn}$变换为坐标系$O_0-x_0y_0z_0$中的矢量$\hat p^0_{mn}$，它在$\hat x_0$、$\hat y_0$和$\hat z_0$三个方向上的分量表达式为：
$$
\begin{bmatrix}
p^0_{mnx}\\p^0_{mny}\\p^0_{mnz}
\end{bmatrix}=
\begin{bmatrix}
cos(\theta_0-\theta_{mn})&0&-sin(\theta_0-\theta_{mn})\\
0&1&0\\
sin(\theta_0-\theta_{mn})&0&cos(\theta_0-\theta_{mn})
\end{bmatrix}
\begin{bmatrix}
cos\triangle\phi_{mn}\\sin\triangle\phi_{mn}\\0
\end{bmatrix}
\tag{6}$$
因此，主极化矢量$\hat p_{mn}$在$x_0y_0$面上的投影与阵列的主极化方向夹角可以看作求得的矢量$\hat p^0_{mn}$与$\hat x_0$之间的夹角。为了使阵元$A_{mn}$对阵列的主极化产生最大的贡献，则该阵元旋转的角度应使夹角最小。

## 单元方向图外推
单元方向图外推是基于AEP方向求解共性阵列方向图的关键，其目的是利用给定的一个或多个单元方向图，通过平移旋转的变换方法，得到阵列中其他相似单元的方向图。当给定的单元方向图为无源方向图时，所求得的阵列方向图也为无源方向图，即不考虑单元间互耦情况下的阵列方向图；当给定的方向图为有源方向图时，单元间的互耦将被纳入计算过程中，所求得的即是考虑单元间互耦情况的阵列方向图。本届采用考虑互耦情况的有源方向图，此法可提高结果的准确性和可靠性。

在全局坐标系$O-xyz$中有一共形单元位于($x_n,y_n,z_n$)处，该单元的相位中心为$O_n$。以$O_n$为坐标原点，建立局部坐标系$O_n-x^{nl}_ny^{nl}_nz^{nl}_n$，其中$z^{nl}_n$沿单元的法线方向。在获得该单元的方向图后，需要将其辐射场外推至空间全局坐标系中，从而获得共性阵列中该单元的辐射场。由于全局坐标系$O-xyz$与单元法相局部坐标系$O_n-x^{nl}_ny^{nl}_nz^{nl}_n$的单位矢量方向不一致，难以建立联系，因而先将单元法向局部坐标系$O_n-x^{nl}_ny^{nl}_nz^{nl}_n$通过旋转变换成与全局坐标系平行的空间局部坐标系$O_n-x^{l}_ny^{l}_nz^{l}_n$，该局部坐标系的原点坐标仍在单元的相位中心$O_n$处。然后，通过坐标系的平移，实现空间局部坐标系$O_n-x^{l}_ny^{l}_nz^{l}_n$到全局坐标系$O-xyz$的转换。

### 坐标系$O_n-x^{nl}_ny^{nl}_nz^{nl}_n$到$O_n-x^{l}_ny^{l}_nz^{l}_n$的转换
已知共形阵列中第n个单元的辐射场为$\vec E(\theta,z)$，它在全局坐标系中可由三个直角坐标分量表示：
$$\vec E_n(\theta,z)=E^x_n(\theta,z)\hat x+E^y_n(\theta,z)\hat y+E^z_n(\theta,z)\hat z\tag{7}$$
同理，该单元的空间局部坐标系$O_n-x^l_ny^l_nz^l_n$和法向局部坐标系$O_n-x^{nl}_ny^{nl}_nz^{nl}_n$中的分量表达式分别为
$$\vec E_n^l(\theta^l,z^l)=E^{xl}_n(\theta^l,z^l)\hat x^l+E^{yl}_n(\theta^l,z^l)\hat y^l+E^{zl}_n(\theta^l,z^l)\hat z^l\tag{8}$$
$$\vec E^{nl}_n(\theta^{nl},z^{nl})=E^{xnl}_n(\theta^{nl},z^{nl})\hat x^{nl}+E^{ynl}_n(\theta^{nl},z^{nl})\hat y^{nl}+E^{znl}_n(\theta^{nl},z^{nl})\hat z^{nl}\tag{9}$$
由于式（7）到式（9）为同一辐射场在三种坐标系下的表示，因此
$$\vec E_n(\theta,z)=\vec E_n^l(\theta^l,z^l)=\vec E^{nl}_n(\theta^{nl},z^{nl})\tag{10}$$
将式（8）和式（9）代入到式（10）中，可得
$$
\begin{bmatrix}
E^{xnl}_n(\theta^{nl}_n,z_n^{nl})&E^{ynl}_n(\theta_n^{nl},z_n^{nl})&E^{znl}_n(\theta_n^{nl},z_n^{nl})
\end{bmatrix}
\begin{bmatrix}
\hat x^{nl}_n\\\hat y_n^{nl}\\\hat z_n^{nl}
\end{bmatrix}=
\begin{bmatrix}
E^{xl}_n(\theta_n^l,z_n^l)&E^{yl}_n(\theta_n^l,z_n^l)&E^{zl}_n(\theta_n^l,z_n^l)
\end{bmatrix}
\begin{bmatrix}
\hat x^l_n\\\hat y^l_n\\\hat z^l_n
\end{bmatrix}
\tag{11}$$
因此，将$\vec E^{nl}_n(\theta^{nl},z^{nl})$转变为$\vec E_n^l(\theta^l,z^l)$需要构建两组对应关系：首先是两个坐标系中方向单位矢量$(\hat x^{nl},\hat y^{nl},\hat z^{nl})$和$(\hat x^{l},\hat y^{l},\hat z^{l})$之间的关系，其次是两个柱面坐标$(\theta^{nl}_n,z^{nl}_n)$与$(\theta^{nl}_n,z^{nl}_n)$之间的关系。

对于方向单位矢量$(\hat x^{nl},\hat y^{nl},\hat z^{nl})$和$(\hat x^{l},\hat y^{l},\hat z^{l})$的变换，可通过三次旋转矩阵相乘来完成，采用“y-x”的旋转顺序，设两次旋转的角度为$\alpha$和$\beta$，其中$\alpha$是以$y^{nl}$轴为旋转轴，$\beta$是以第一次旋转后的新的$x^{nl}$轴为旋转轴。相应的欧拉旋转矩阵为：
$$I=I_2I_1\tag{12}$$
其中
$$
I_1=
\begin{bmatrix}
cos\alpha&0&-sin\alpha\\
0&1&0\\
sin\alpha&0&cos\alpha
\end{bmatrix}
\tag{13}$$
$$
I_2=
\begin{bmatrix}
1&0&0\\
0&cos\beta&sin\beta\\
0&-sin\beta&cos\beta
\end{bmatrix}
\tag{14}$$

则两个方向单位矢量之间的关系为：
$$
\begin{bmatrix}
\hat x^{l}_n\\\hat y^{l}_n\\\hat z^{l}_n
\end{bmatrix}=I
\begin{bmatrix}
\hat x^{nl}_n\\\hat y^{nl}_n\\\hat z_n^{nl}
\end{bmatrix}=I_2I_1
\begin{bmatrix}
\hat x^{nl}_n\\\hat y^{nl}_n\\\hat z_n^{nl}
\end{bmatrix}
\tag{16}$$

对于法向局部坐标$(\theta_n^{nl},z_n^{nl})$到空间局部坐标$(\theta_n^{l},z_n^{l})$的转换，将式（16）代入到式（11）中得：
$$
\begin{bmatrix}
E^{xnl}_n(\theta^{nl}_n,z_n^{nl})&E^{ynl}_n(\theta_n^{nl},z_n^{nl})&E^{znl}_n(\theta_n^{nl},z_n^{nl})
\end{bmatrix}
\begin{bmatrix}
\hat x^{nl}_n\\\hat y_n^{nl}\\\hat z_n^{nl}
\end{bmatrix}=
\begin{bmatrix}
E^{xl}_n(\theta_n^l,z_n^l)&E^{yl}_n(\theta_n^l,z_n^l)&E^{zl}_n(\theta_n^l,z_n^l)
\end{bmatrix}I_2I_1
\begin{bmatrix}
\hat x^{nl}_n\\\hat y_n^{nl}\\\hat z_n^{nl}
\end{bmatrix}
\tag{17}$$
对空间中某一点P处的场，假设其在法向局部坐标系中的坐标为$(R_n^{nl},\theta_n^{nl},z_n^{nl})$，将其转换为直角坐标的形式：
$$
E_n^{nlx}(\theta_n^{nl},z_n^{nl})=R_n^{nl}cos\theta_n^{nl},
E_n^{nly}(\theta_n^{nl},z_n^{nl})=R_n^{nl}sin\theta_n^{nl},
E_n^{nlz}(\theta_n^{nl},z_n^{nl})=z_n^{nl}
\tag{18}$$
设P点在空间局部坐标系中的坐标为$(R_n^{l},\theta_n^{l},z_n^{l})$，同理，也可写出其直角坐标公式：
$$
E_n^{lx}(\theta_n^{l},z_n^{l})=R_n^{l}cos\theta_n^{l},
E_n^{ly}(\theta_n^{l},z_n^{l})=R_n^{l}sin\theta_n^{l},
E_n^{lz}(\theta_n^{l},z_n^{l})=z_n^{l}
\tag{19}$$
此时，由于法向局部坐标系$O_n-x_n^{nl}y_n^{nl}z_n^{nl}$与空间局部坐标系$O_n-x_n^{l}y_n^{l}z_n^{l}$的原点为同一点$O_n$，因此该点在这两个坐标系下到P点的距离相等，即$R^l_n=R_n^{nl}$。

联合式（17）到式（19）得：
$$
\begin{bmatrix}
cos\theta_n^{nl}&sin\theta_n^{nl}&z_n^{nl}
\end{bmatrix}
\begin{bmatrix}
\hat x^{nl}_n\\\hat y_n^{nl}\\\hat z_n^{nl}
\end{bmatrix}=
\begin{bmatrix}
cos\theta_n^{l}&sin\theta_n^{l}&z_n^l
\end{bmatrix}I_2I_1
\begin{bmatrix}
\hat x^{nl}_n\\\hat y_n^{nl}\\\hat z_n^{nl}
\end{bmatrix}
\tag{20}$$
将旋转矩阵代入上式可得
$$
\begin{bmatrix}
cos\theta_n^{nl}&sin\theta_n^{nl}&z_n^{nl}
\end{bmatrix}=
\begin{bmatrix}
cos\theta_n^{l}&sin\theta_n^{l}&z_n^l
\end{bmatrix}
\begin{bmatrix}
1&0&0\\
0&cos\beta&sin\beta\\
0&-sin\beta&cos\beta
\end{bmatrix}
\begin{bmatrix}
cos\alpha&0&-sin\alpha\\
0&1&0\\
sin\alpha&0&cos\alpha
\end{bmatrix}
\tag{21}$$
由式（21）中$(\theta_n^{nl},z_n^{nl})$到$(\theta_n^{l},z_n^{l})$得变换关系，可以得到$\begin{bmatrix}E_n^{nlx}(\theta_n^{nl},z_n^{nl})&E_n^{nly}(\theta_n^{nl},z_n^{nl})&E_n^{nlz}(\theta_n^{nl},z_n^{nl})\end{bmatrix}$到$\begin{bmatrix}E_n^{lx}(\theta_n^{l},z_n^{l})&E_n^{ly}(\theta_n^{l},z_n^{l})&E_n^{lz}(\theta_n^{l},z_n^{l})\end{bmatrix}$的变换。至此，实现了单元法向局部坐标系$O_n-x_n^{nl}y_n^{nl}z_n^{nl}$与空间局部坐标系$O_n-x_n^{l}y_n^{l}z_n^{l}$的转换。

### 坐标系$O_n-x_n^{l}y_n^{l}z_n^{l}$到$O-xyz$的转换
将式（7）和式（8）代入到式（10）中可得$\vec E_n(\theta,z)$和$\vec E_n^l(\theta^l_n,z^l_n)$之间的关系：
$$
\begin{bmatrix}
E_n^x(\theta,z)&E_n^y(\theta,z)&E_n^z(\theta,z)
\end{bmatrix}
\begin{bmatrix}
\hat x\\\hat y\\\hat z
\end{bmatrix}=
\begin{bmatrix}
E_n^{lx}(\theta^l,z^l)&E_n^{ly}(\theta^l,z^l)&E_n^{lz}(\theta^l,z^l)
\end{bmatrix}
\begin{bmatrix}
\hat x^l_n\\\hat y^l_n\\\hat z^l_n
\end{bmatrix}
\tag{22}$$
与法向局部坐标系到空间局部坐标系类似，空间局部坐标系到全局坐标系的变换同样可分为两个对应关系，即方向单位矢量$(\hat x^l_n,\hat y^l_n,\hat z^l_n)$和$(\hat x,\hat y,\hat z)$之间的关系以及两个柱面坐标$(\theta_n^l,z^l_n)$和$(\theta,z)$之间的关系。

对于远场中的某一点P，可以认为$OP$和$OP'$是平行的，由于两个坐标系的方向单位矢量式是平行的，因此有$\hat x=\hat x^l_n$，$\hat y=\hat y^l_n$，$\hat z=\hat z^l_n$，$\theta=\theta^l_n$。所以两个坐标系之间只存在一个波程差$d_n$，它可以看作是$\vec R_n$在$\hat R$方向上的投影：
$$
d_n=\hat R\cdot\vec R_n=\hat R\cdot\hat R_nR_n
\tag{23}$$
式中
$$
\hat R=\hat xcos\theta+\hat ysin\theta+\hat z
\tag{24}$$
$$
\hat R_n=\hat xcos\theta_n+\hat ysin\theta_n+\hat z
\tag{25}$$
为两条射线的单位矢量，$R_n$为$OO_n$的距离。因此可结合式（23）到式（25）得到$d_n$。由此可求得全局坐标系下的单元辐射场表达式：
$$
\vec E_n(\theta,z)=\vec E^l_n(\theta^l_n,z^l_n)exp(jkd_n)
\tag{26}$$
至此，完成了一直阵列中某个单元局部坐标系下的辐射场来求得它在阵列全局坐标系下的全过程。基于AEP的方法可将阵列中不同位置但具有相似特性的单元用同一个局部坐标系下的辐射场来表示，因此省略了对阵列中部分单元辐射场的计算，仅需要通过坐标的变换，即可获得不同单元在全局坐标系的辐射场，极大的减少了计算时间。

### 阵列总场的计算
根据上述的三个步骤：有源单元的选取、有源单元的极化补偿和单元方向图外推，可以得到阵列中全部有源单元在全局坐标系下的单元辐射场，应用方向图叠加原理，即可获得阵列的辐射总场：
$$
\vec E(\theta,z)=\sum^N_{n=1}\vec E_n(\theta,z)
\tag{27}$$

## 程序设计与演示算例
共形阵方向图快速计算程序主要包含三大功能模块：输入模块、计算模块和输出模块。

首先通过输入模块输入模型的结构参数，包括载体的尺寸和阵列的排布方式，设定单元的工作频率，读取单元的基本辐射场信息，并进行数据的预处理；给出计算所需的初始条件，包含单元最大有效辐射角、阵列期望的波束指向、以及部分计算步骤的功能开关等参数。

然后通过计算模块，利用输入的结构参数计算单元的排布位置，根据条件参数进行有源区域的选择，基于给定单元的方向图，进行极化旋转补偿、方向图外推、空间相位补偿和方向图叠加等一系列计算。

最后通过输出模块，实时显示计算进度和状态，给出阵列总单元数、单元排布行列数、有源区域单元数、最大增益和计算时间，并输出共形阵列的结构、有源单元的分布位置、计算得到的阵列3D方向图及其最大辐射方向上两个正交切面上的平面方向图。
通过上述三个模块，该程序能够完成指定要求下任意尺寸、任意频率、任意扫描方向的阵列结构和方向图的快速计算，并具有可视化的输出图形。

## 阵列仿真计算结果